{
  @ (0:crit00, 1:crit00) false /\
  @ (0:crit01, 1:crit01) false /\
  @ (0:crit10, 1:crit10) false /\
  @ (0:crit11, 1:crit11) false
}

/*
item: TYPE
slot: ARRAY [boolean, boolean] OF item;
index: ARRAY [boolean] OF boolean;
latest, reading: boolean;

PROCESS writer(in: item);           PROCESS reader(out: item);
wpair, windex: boolean;             rpair, rindex: boolean;
*/

latest = 1, reading = 0,
slot00 = 0, slot01 = 0, slot10 = 0, slot11 = 0,
index0 = 0, index1 = 0

#### THREAD WRITER ####

in := 1

// !wpair := reading;
wpair := reading

// windex := !index[wpair];
if wpair = 0 {
    windex := index0
}

if wpair = 1 {
    windex := index1
}

// slot[wpair][windex] := in;
if wpair = 0 && windex = 0 {
   label crit00
   slot00 := in
}

if wpair = 0 && windex = 1 {
   label crit01
   slot01 := in
}

if wpair = 1 && windex = 0 {
   label crit10
   slot10 := in
}

if wpair = 1 && windex = 1 {
   label crit11
   slot11 := in
}

// index[wpair] := windex;
if wpair = 0 {
    index0 := windex
}

if wpair = 1 {
    index1 := windex
}

// latest := wpair;
latest := wpair

#### THREAD READER ####

// rpair := latest;
rpair := latest

// reading := rpair;
reading := rpair

// rindex := index[rpair];
if rpair = 0 {
    rindex := index0
}

if rpair = 1 {
    rindex := index1
}

// out := slot[rpair][rindex];
if rpair = 0 && rindex = 0 {
   label crit00
   out := slot00
}

if rpair = 0 && rindex = 1 {
   label crit01
   out := slot01
}

if rpair = 1 && rindex = 0 {
   label crit10
   out := slot10
}

if rpair = 1 && rindex = 1 {
   label crit11
   out := slot11
}
